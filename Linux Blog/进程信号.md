# 进程信号

### 信号入门

> 信号有很多种，
>
> 不同的信号，会有不同的处理方式，
>
> 在信号发生之前，每种信号如何处理，都是提前知道的

### 信号概念

> * 信号时进程之间事件异步通知的一种方式，属于软中断

### 信号的作用

> 处理系统在运行过程中遇到的各种意外情况

### 信号的产生方式

> * 键盘按键产生
>   * ctrl + c =>2
>   * ctrl + z =>19
>   * ctrl + \ =>3
> * 硬件产生的信号
>   * MMU产生的信号->11
>     * MMU负责从虚拟地址翻译成物理地址，如果发现虚拟地址非法，MMU硬件设备就会告诉操作系统这个情况，由操作系统给指定进程发送一个11号信号，返回段错误
>     * 内存访问越界/解引用空指针
>   * CPU产生的信号->8
>     * 除零问题
> * 软件条件产生信号
>   * assert->6
>     * 内部调用abort()函数，触发SIGABRT信号，使得进程异常终止，没有明确报错
>   * PIPE读端关闭，尝试写，就会触发SIGPIPE信号，管道破裂
>   * TCP一定条件下也会触发SIGPIPE信号
> * 系统调用产生

### 信号的处理方式

> * 忽略此信号
> * 执行该信号的默认处理动作，大部分信号的默认行为，都是终止进程
> * 提供一个信号处理函数，要求内核在处理该信号时切换到用户执行这个处理函数，这种方式称为捕捉（Catch）一个新号，通过自定制的行为来处理信号

### 信号捕捉初识

> signal替换了信号原有的处理方式（通过返回值返回原有的处理方式）

### 信号的捕捉流程

> 用户通过signal捕捉某个信号，执行到某个逻辑，触发了一个信号，交给内核处理
>
> 内核根据信号的种类来决定如何处理，
>
> * 如果是进行捕捉，则调用对应的回调函数，回到用户模式继续信号处理函数，**信号处理函数是一个独立的执行流，和原来的用户代码之间没有相互调用的关系，信号处理函数执行过程中，原有的执行流就在等待。**正常处理完后交给内核，内核再返回给用户模式，从主控制流程中上次被中断的地方继续向下执行
> * 如果是信号的处理

### 阻塞信号

> 信号不会立刻被处理，而是要等到时机合适再进行处理

##### 信号在内核中的表示

> task_struct

> * 未决信号集
>   * 操作系统给进程发信号，本质上就是在未决信号集中写一个信号的信息（几号信号），位图
> * 阻塞信号集
>   * 标识不立刻处理的信号，可以通过一些函数来操作阻塞信号集，位图
> * 信号处理函数集
>   * 实质上是函数指针数组，通过信号的ID作为下标找到相应的信号处理函数
>
> **同一时刻一个进程收到了大量的号1—31号信号，极有可能只处理一次**
>
> 一个函数如果在多个执行流中被调用，就可能会出问题

##### 可重入函数

> 一个函数可重入，就意味着在多个执行流中调用没什么问题的
>
> 如果一个函数使用了全局变量/静态变量，不可重入
>
> 如果一个函数调用了不可重入函数，也是不可重入的

##### signal（SIGCHLD,SIG_IGN），不考虑子进程的结果，可以这样简单的防止僵尸进程